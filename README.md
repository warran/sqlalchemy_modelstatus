# sqlalchemy_modelstatus

sqlalchemy_modelstatus is a simple package providing a SQLAlchemy Mixin class to 
track status of your model.

Status can be definied as dict-type class attribute - this definition can contain 
information like: which status transitions should be possible, what should be
the default status value, etc.

## Usage

### Installation

Installation is done via setuptools in a standard way

```
$ git clone git@github.com:warran/sqlalchemy_modelstatus.git
$ cd sqlalchemy_modelstatus
$ python setup.py build &amp;&amp; sudo python setup.py install
```

### Basic usage

Provided Mixin's name is `StatusModelMixin`. To add status to your model, first, 
inherit from this class as well as from `Base`:

```python
from sqlalchemy_modelstatus import StatusModelMixin
```

Now we need to describe our status with status definition. Exemplary status definition:

#### Status defintion

```python
class MyModel(StatusModelMixin, Base):
    __tablename__ = 'my_model'
    
    __status_defintion__ = {
        'status': {
            'access_pending': 'tc_pending',
            'tc_pending': ['access_denied', 'offline'],
            'access_denied': ['offline', 'locked', 'tc_pending'],
            'offline': ['access_denied', 'online', 'locked'],
            'online': 'offline',
            'locked': 'offline'
        },
        'default': 'access_pending'
    }
```

This definition relates to the following state diagram

![Status diagram](https://ibb.co/d4L3vk)

#### Attributes

Using the `StatusModelMixin` as a base class creates two special attributes in the
class: `status` and `statuses`.

##### `status`

`status` is automatically generated column that can be set only to one of the values from
the `__status_definition__` dictionary, and default value same as the one under
`default` key in this dict.

##### `statuses`

`statuses` contains all possible values of the status, to make checking and assigning 
the status easier. It's actually [PEP-435](https://www.python.org/dev/peps/pep-0435/) compliant Enum with all values names being in
upper case, so for example:

`MyModel.statuses.ACCESS_PENDING.value`

is equal to `access_pending`.

It also possible to use the enum's object directly, without getting it's `value`. For example,
the following expressions are valid and will act as you'd expect them to

```python
my_instance.status = MyModel.statuses.TC_PENDING
my_instance.status == MyModel.statuses.OFFLINE
```

##### `status` transitions

Status definition will also restrict the possible transitions. Every time the `status` value
is set, the transition is validated. The new status value has to be present on the list
associated with the current status value, otherwise `StatusTransitionException` is being
thrown.

For example

```python
my_instance.status == MyModel.statuses.ONLINE   # True
my_instance.status = MyModel.statuses.OFFLINE   # correct
my_instance.status = MyModel.statuses.ACCESS_PENDING    # exception!
```

## TODO

* add status groups
* add `ANY` and `PREVIOUS` keywords to status definition
* add autogenerated status-changing actions
* add possibility to change status-related attributes names
